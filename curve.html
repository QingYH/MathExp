<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>空间解析几何曲面可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            font-family: 'Microsoft YaHei', sans-serif;
            color: #fff;
        }
        #container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            width: 300px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        .control-group {
            margin-bottom: 15px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        label {
            display: block;
            margin: 8px 0;
        }
        select, input, button {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
        }
        button {
            background: #4CAF50;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            max-width: 300px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #f44336;
            z-index: 100;
        }
        .param-control {
            display: flex;
            align-items: center;
        }
        .param-control input {
            flex: 1;
            margin-right: 10px;
        }
        .param-control span {
            width: 50px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="control-panel">
        <h2>曲面控制面板</h2>
        <div class="control-group">
            <label for="surface-type">曲面类型:</label>
            <select id="surface-type">
                <option value="sphere">球面</option>
                <option value="ellipsoid">椭球面</option>
                <option value="cylinder">圆柱面</option>
                <option value="cone">圆锥面</option>
                <option value="hyperboloid1">单叶双曲面</option>
                <option value="hyperboloid2">双叶双曲面</option>
                <option value="paraboloid">椭圆抛物面</option>
                <option value="saddle">双曲抛物面</option>
            </select>
        </div>

        <div class="control-group" id="param-controls">
            <!-- 动态参数控制区 -->
        </div>

        <div class="control-group">
            <label>显示设置:</label>
            <div class="param-control">
                <input type="color" id="surface-color" value="#ff0000">
                <span>颜色</span>
            </div>
            <div class="param-control">
                <input type="range" id="surface-opacity" min="0.1" max="1" step="0.1" value="0.8">
                <span>透明度</span>
            </div>
            <div class="param-control">
                <input type="checkbox" id="wireframe" checked>
                <span>网格线</span>
            </div>
        </div>

        <button id="update-btn">更新曲面</button>
    </div>

    <div id="info-panel">
        <h3 id="equation-display">球面方程: x² + y² + z² = r²</h3>
        <h4>操作说明:</h4>
        <p>• 左键拖动 - 旋转视图</p>
        <p>• 右键拖动 - 平移视图</p>
        <p>• 滚轮 - 缩放视图</p>
        <p>• 双击 - 重置视图</p>
    </div>

    <button class="back-btn" onclick="window.history.back()">返回上一页</button>

    <script>
        // 初始化Three.js场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);
        document.getElementById('container').appendChild(renderer.domElement);

        // 添加光源
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);

        // 添加坐标轴辅助
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);

        // 轨道控制器
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(5, 5, 5);
        controls.update();

        // 当前曲面对象
        let currentSurface = null;
        
        // 曲面参数配置
        const surfaceParams = {
            sphere: { r: 1 },
            ellipsoid: { a: 1, b: 1, c: 1 },
            cylinder: { r: 1, h: 2 },
            cone: { r: 1, h: 2 },
            hyperboloid1: { a: 1, b: 1, c: 1 },
            hyperboloid2: { a: 1, b: 1, c: 1 },
            paraboloid: { a: 1, b: 1 },
            saddle: { a: 1, b: 1 }
        };

        // 曲面方程显示
        const surfaceEquations = {
            sphere: (p) => `球面方程: x² + y² + z² = ${p.r}²`,
            ellipsoid: (p) => `椭球面方程: (x²/${p.a}²) + (y²/${p.b}²) + (z²/${p.c}²) = 1`,
            cylinder: (p) => `圆柱面方程: x² + y² = ${p.r}²`,
            cone: (p) => `圆锥面方程: z² = (${p.r/p.h}²)(x² + y²)`,
            hyperboloid1: (p) => `单叶双曲面: (x²/${p.a}²) + (y²/${p.b}²) - (z²/${p.c}²) = 1`,
            hyperboloid2: (p) => `双叶双曲面: (x²/${p.a}²) - (y²/${p.b}²) - (z²/${p.c}²) = 1`,
            paraboloid: (p) => `椭圆抛物面: z = (x²/${p.a}²) + (y²/${p.b}²)`,
            saddle: (p) => `双曲抛物面: z = (x²/${p.a}²) - (y²/${p.b}²)`
        };

        // 创建参数控制界面
        function createParamControls(type) {
            const params = surfaceParams[type];
            const container = document.getElementById('param-controls');
            container.innerHTML = '<h3>曲面参数:</h3>';
            
            for (const param in params) {
                const div = document.createElement('div');
                div.className = 'param-control';
                
                const label = document.createElement('label');
                label.textContent = param + ':';
                label.style.display = 'inline-block';
                label.style.width = '60px';
                
                const input = document.createElement('input');
                input.type = 'range';
                input.id = `param-${param}`;
                input.min = '0.1';
                input.max = '5';
                input.step = '0.1';
                input.value = params[param];
                
                const valueSpan = document.createElement('span');
                valueSpan.id = `value-${param}`;
                valueSpan.textContent = params[param];
                
                input.addEventListener('input', (e) => {
                    valueSpan.textContent = e.target.value;
                });
                
                div.appendChild(label);
                div.appendChild(input);
                div.appendChild(valueSpan);
                container.appendChild(div);
            }
            
            // 更新方程显示
            document.getElementById('equation-display').textContent = surfaceEquations[type](params);
        }

        // 创建曲面
        function createSurface(type) {
            if (currentSurface) scene.remove(currentSurface);
            
            // 获取参数值
            const params = {};
            for (const param in surfaceParams[type]) {
                params[param] = parseFloat(document.getElementById(`param-${param}`).value);
            }
            
            // 获取显示设置
            const color = document.getElementById('surface-color').value;
            const opacity = parseFloat(document.getElementById('surface-opacity').value);
            const wireframe = document.getElementById('wireframe').checked;
            
            let geometry;
            
            switch(type) {
                case 'sphere':
                    geometry = new THREE.SphereGeometry(params.r, 64, 64);
                    break;
                case 'ellipsoid':
                    geometry = new THREE.SphereGeometry(1, 64, 64);
                    geometry.scale(params.a, params.b, params.c);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(params.r, params.r, params.h, 64);
                    geometry.rotateX(Math.PI/2);
                    break;
                case 'cone':
                    geometry = new THREE.ConeGeometry(params.r, params.h, 64);
                    geometry.rotateX(Math.PI);
                    break;
                case 'hyperboloid1':
                    geometry = createParametricSurface((u, v, target) => {
                        u = u * Math.PI * 2;
                        v = v * 2 - 1;
                        target.x = params.a * Math.sqrt(1 + v*v) * Math.cos(u);
                        target.y = params.b * Math.sqrt(1 + v*v) * Math.sin(u);
                        target.z = params.c * v;
                    }, 64, 64);
                    break;
                case 'hyperboloid2':
                    geometry = createParametricSurface((u, v, target) => {
                        u = u * Math.PI * 2;
                        v = v * 4 - 2;
                        if (Math.abs(v) > 1) {
                            target.x = params.a * Math.sqrt(v*v - 1) * Math.cos(u);
                            target.y = params.b * Math.sqrt(v*v - 1) * Math.sin(u);
                            target.z = params.c * v;
                        } else {
                            target.x = 0;
                            target.y = 0;
                            target.z = params.c * v;
                        }
                    }, 64, 64);
                    break;
                case 'paraboloid':
                    geometry = createParametricSurface((u, v, target) => {
                        u = (u - 0.5) * 4;
                        v = (v - 0.5) * 4;
                        target.x = u;
                        target.y = v;
                        target.z = (u*u)/(params.a*params.a) + (v*v)/(params.b*params.b);
                    }, 64, 64);
                    break;
                case 'saddle':
                    geometry = createParametricSurface((u, v, target) => {
                        u = (u - 0.5) * 4;
                        v = (v - 0.5) * 4;
                        target.x = u;
                        target.y = v;
                        target.z = (u*u)/(params.a*params.a) - (v*v)/(params.b*params.b);
                    }, 64, 64);
                    break;
            }
            
            const material = new THREE.MeshPhongMaterial({
                color: new THREE.Color(color),
                transparent: true,
                opacity: opacity,
                wireframe: wireframe,
                side: THREE.DoubleSide
            });
            
            currentSurface = new THREE.Mesh(geometry, material);
            scene.add(currentSurface);
            
            // 更新方程显示
            document.getElementById('equation-display').textContent = surfaceEquations[type](params);
        }

        // 创建参数化曲面
        function createParametricSurface(func, slices, stacks) {
            return new THREE.ParametricGeometry(func, slices, stacks);
        }

        // 事件监听
        document.getElementById('surface-type').addEventListener('change', (e) => {
            createParamControls(e.target.value);
        });

        document.getElementById('update-btn').addEventListener('click', () => {
            const type = document.getElementById('surface-type').value;
            createSurface(type);
        });

        // 窗口大小调整
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 双击重置视图
        renderer.domElement.addEventListener('dblclick', () => {
            controls.reset();
        });

        // 初始化
        createParamControls('sphere');
        createSurface('sphere');

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
