<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>空间解析几何曲面可视化</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { 
            margin: 0;
            overflow: hidden;
            background: url('https://example.com/math-bg.jpg') center/cover;
            font-family: 'Arial', sans-serif;
            color: #fff;
        }
        #container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #menu {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }
        select, button {
            padding: 8px 15px;
            margin: 5px;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        #info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
        }
        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #f44336;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="menu">
        <h2>曲面选择</h2>
        <select id="surface-select">
            <option value="sphere">球面 x²+y²+z²=1</option>
            <option value="cylinder">圆柱面 x²+y²=1</option>
            <option value="cone">圆锥面 z²=x²+y²</option>
            <option value="hyperboloid1">单叶双曲面 x²+y²-z²=1</option>
            <option value="hyperboloid2">双叶双曲面 x²-y²-z²=1</option>
            <option value="paraboloid">椭圆抛物面 z=x²+y²</option>
            <option value="saddle">双曲抛物面 z=x²-y²</option>
        </select>
        <button id="draw-btn">绘制曲面</button>
        <button id="color-btn">随机颜色</button>
    </div>
    <div id="info">
        <h3>操作说明：</h3>
        <p>1. 鼠标左键拖动 - 旋转视图</p>
        <p>2. 鼠标右键拖动 - 平移视图</p>
        <p>3. 鼠标滚轮 - 缩放视图</p>
        <p>4. 双击曲面 - 重置视图</p>
    </div>
    <button class="back-btn" onclick="window.history.back()">返回上一页</button>

    <script>
        // 初始化场景、相机和渲染器
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000, 0);
        document.getElementById('container').appendChild(renderer.domElement);

        // 添加光源
        const light1 = new THREE.DirectionalLight(0xffffff, 1);
        light1.position.set(1, 1, 1);
        scene.add(light1);
        const light2 = new THREE.AmbientLight(0x404040);
        scene.add(light2);

        // 添加坐标轴辅助
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);

        // 添加轨道控制器
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(3, 3, 3);
        controls.update();

        // 曲面参数
        let currentSurface = null;
        const surfaces = {
            sphere: { equation: "x² + y² + z² = 1", color: 0xff0000 },
            cylinder: { equation: "x² + y² = 1", color: 0x00ff00 },
            cone: { equation: "z² = x² + y²", color: 0x0000ff },
            hyperboloid1: { equation: "x² + y² - z² = 1", color: 0xffff00 },
            hyperboloid2: { equation: "x² - y² - z² = 1", color: 0xff00ff },
            paraboloid: { equation: "z = x² + y²", color: 0x00ffff },
            saddle: { equation: "z = x² - y²", color: 0xffffff }
        };

        // 创建曲面几何体
        function createSurface(type) {
            if (currentSurface) scene.remove(currentSurface);
            
            let geometry, material;
            const color = surfaces[type].color;
            
            switch(type) {
                case 'sphere':
                    geometry = new THREE.SphereGeometry(1, 32, 32);
                    break;
                case 'cylinder':
                    geometry = new THREE.CylinderGeometry(1, 1, 4, 32, 1, true);
                    geometry.rotateX(Math.PI/2);
                    break;
                case 'cone':
                    geometry = new THREE.ConeGeometry(1, 2, 32);
                    geometry.rotateX(Math.PI);
                    break;
                case 'hyperboloid1':
                    geometry = createParametricSurface((u, v, target) => {
                        u = u * Math.PI * 2;
                        v = v * 2 - 1;
                        const scale = 1.5;
                        target.x = scale * Math.sqrt(1 + v*v) * Math.cos(u);
                        target.y = scale * Math.sqrt(1 + v*v) * Math.sin(u);
                        target.z = scale * v;
                    }, 50, 50);
                    break;
                case 'hyperboloid2':
                    geometry = createParametricSurface((u, v, target) => {
                        u = u * Math.PI * 2;
                        v = v * 4 - 2;
                        const scale = 1;
                        if (Math.abs(v) > 1) {
                            target.x = scale * Math.sqrt(v*v - 1) * Math.cos(u);
                            target.y = scale * Math.sqrt(v*v - 1) * Math.sin(u);
                            target.z = scale * v;
                        } else {
                            target.x = 0;
                            target.y = 0;
                            target.z = scale * v;
                        }
                    }, 50, 50);
                    break;
                case 'paraboloid':
                    geometry = createParametricSurface((u, v, target) => {
                        u = (u - 0.5) * 4;
                        v = (v - 0.5) * 4;
                        target.x = u;
                        target.y = v;
                        target.z = u*u + v*v;
                    }, 50, 50);
                    break;
                case 'saddle':
                    geometry = createParametricSurface((u, v, target) => {
                        u = (u - 0.5) * 4;
                        v = (v - 0.5) * 4;
                        target.x = u;
                        target.y = v;
                        target.z = u*u - v*v;
                    }, 50, 50);
                    break;
            }
            
            material = new THREE.MeshPhongMaterial({ 
                color: color,
                side: THREE.DoubleSide,
                wireframe: false,
                transparent: true,
                opacity: 0.9
            });
            
            currentSurface = new THREE.Mesh(geometry, material);
            scene.add(currentSurface);
            
            // 更新信息
            document.getElementById('info').innerHTML = `
                <h3>${type} - ${surfaces[type].equation}</h3>
                <p>操作说明：</p>
                <p>1. 鼠标左键拖动 - 旋转视图</p>
                <p>2. 鼠标右键拖动 - 平移视图</p>
                <p>3. 鼠标滚轮 - 缩放视图</p>
                <p>4. 双击曲面 - 重置视图</p>
            `;
        }

        // 创建参数化曲面
        function createParametricSurface(func, slices, stacks) {
            const geometry = new THREE.ParametricGeometry(func, slices, stacks);
            return geometry;
        }

        // 事件监听
        document.getElementById('draw-btn').addEventListener('click', () => {
            const selected = document.getElementById('surface-select').value;
            createSurface(selected);
        });

        document.getElementById('color-btn').addEventListener('click', () => {
            if (currentSurface) {
                currentSurface.material.color.setHex(Math.random() * 0xffffff);
            }
        });

        // 窗口大小调整
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 双击重置视图
        renderer.domElement.addEventListener('dblclick', () => {
            controls.reset();
        });

        // 默认绘制球面
        createSurface('sphere');

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
