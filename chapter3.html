<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微分中值定理与导数应用 - 完整学习系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
            --purple: #7209b7;
            --border-radius: 12px;
            --shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "f'(ξ)=0";
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 60px;
            color: rgba(67, 97, 238, 0.1);
            font-weight: bold;
        }
        
        h1 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 2.8rem;
            position: relative;
            display: inline-block;
        }
        
        h1::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 25%;
            width: 50%;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .sidebar {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h2 i {
            color: var(--accent);
        }
        
        .definition, .theorem, .formula, .exercise {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }
        
        .definition {
            background-color: rgba(67, 97, 238, 0.08);
            border-left: 5px solid var(--primary);
        }
        
        .theorem {
            background-color: rgba(248, 150, 30, 0.08);
            border-left: 5px solid var(--warning);
        }
        
        .formula {
            background-color: rgba(76, 201, 240, 0.08);
            border-left: 5px solid var(--success);
            font-family: 'Cambria Math', serif;
            overflow-x: auto;
        }
        
        .exercise {
            background-color: rgba(248, 37, 133, 0.05);
            border-left: 5px solid var(--accent);
        }
        
        .definition h3, .theorem h3, .formula h3, .exercise h3 {
            margin-bottom: 10px;
            color: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .self-review {
            background: rgba(248, 37, 133, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
            border: 1px dashed var(--accent);
            position: relative;
        }
        
        .self-review::before {
            content: "💡 灵魂拷问：";
            font-weight: bold;
            color: var(--accent);
        }
        
        .analogy {
            background: rgba(76, 201, 240, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px dashed var(--success);
            position: relative;
        }
        
        .analogy::before {
            content: "🔍 神比喻：";
            font-weight: bold;
            color: var(--success);
        }
        
        .history-fact {
            background: rgba(248, 150, 30, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px dashed var(--warning);
            position: relative;
        }
        
        .history-fact::before {
            content: "📜 数学史趣闻：";
            font-weight: bold;
            color: var(--warning);
        }
        
        .graph-container {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ddd;
            overflow: hidden;
            position: relative;
        }
        
        .graph-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
            align-items: center;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }
        
        .graph-controls button, .graph-controls select, .graph-controls input {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .graph-controls button:hover, .graph-controls select:hover {
            background: #f0f0f0;
        }
        
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .answer {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: rgba(76, 201, 240, 0.1);
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }
        
        .answer.show {
            display: block;
        }
        
        .show-answer {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .show-answer:hover {
            background: var(--primary);
            color: white;
        }
        
        .error-tip {
            background: rgba(248, 37, 133, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--accent);
        }
        
        .error-tip h4 {
            color: var(--accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .chapter-nav {
            list-style: none;
            margin-top: 20px;
        }
        
        .chapter-nav li {
            margin-bottom: 12px;
        }
        
        .chapter-nav a {
            display: block;
            padding: 12px 15px;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .chapter-nav a:hover, .chapter-nav a.active {
            background: rgba(67, 97, 238, 0.2);
            border-left: 4px solid var(--primary);
        }
        
        .chapter-nav i {
            margin-right: 10px;
            color: var(--primary);
            width: 20px;
            text-align: center;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 30px 0 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--success));
            width: 20%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
        }
        
        .canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .method-steps {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }
        
        .method-steps h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .method-steps ol {
            padding-left: 20px;
        }
        
        .method-steps li {
            margin-bottom: 8px;
        }
        
        .fun-fact {
            background: rgba(230, 57, 70, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--danger);
        }
        
        .fun-fact::before {
            content: "🤔 冷知识：";
            font-weight: bold;
            color: var(--danger);
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        
        .summary-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .summary-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }
        
        .summary-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .summary-table tr:hover {
            background: #f0f7ff;
        }
        
        .important {
            background: rgba(255, 193, 7, 0.1);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .curvature-container {
            background: rgba(114, 9, 183, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid var(--purple);
        }
        
        .curvature-container h3 {
            color: var(--purple);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .practice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .practice-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary);
        }
        
        .practice-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .toggle-details {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        .toggle-details:hover {
            background: var(--primary);
            color: white;
        }
        
        .details {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }
        
        .details.show {
            display: block;
        }
        
        .hint {
            background: rgba(255, 193, 7, 0.1);
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #ffc107;
            font-size: 0.9rem;
        }
        
        .graph-info {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .limit-graph-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }
        
        .limit-graph-controls > div {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .limit-value-display {
            font-family: 'Cambria Math', serif;
            font-size: 1.1rem;
            color: var(--primary);
            padding: 5px 10px;
            background: rgba(67, 97, 238, 0.1);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-search"></i> 微分中值定理与导数应用</h1>
        <p class="subtitle">同济高数第七/八版上册第三章 · 动态图形演示 · 知识点全面覆盖 · 幽默风趣讲解</p>
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <p>学习进度: <span id="progress-text">20%</span> · 已掌握知识点: <span id="mastered-count">0</span>/24</p>
    </header>
    
    <div class="container">
        <main class="main-content">
            <!-- 第一节：微分中值定理 -->
            <section class="card" id="section1">
                <h2><i class="fas fa-balance-scale"></i> 第一节：微分中值定理 - 数学界的"三大神探"</h2>
                
                <div class="history-fact">
                    <p><strong>罗尔 vs 拉格朗日 vs 柯西：</strong> 这三位数学家虽然生活在不同时代，但他们的定理构成了微积分的核心。罗尔定理（1691年）最初只是拉格朗日定理的特例，但因其简洁性而独立成名。拉格朗日（1797年）被誉为"数学界的莎士比亚"，而柯西（1823年）则以严格化微积分闻名。</p>
                </div>
                
                <div class="theorem">
                    <h3><i class="fas fa-user-tie"></i> 罗尔定理 (Rolle's Theorem) - "平平无奇"的侦探</h3>
                    <p><strong>条件：</strong></p>
                    <ol>
                        <li>\( f(x) \) 在 \([a, b]\) 上连续</li>
                        <li>\( f(x) \) 在 \((a, b)\) 内可导</li>
                        <li>\( f(a) = f(b) \)</li>
                    </ol>
                    <p><strong>结论：</strong> 至少存在一点 \(\xi \in (a, b)\)，使得 \( f'(\xi) = 0 \)</p>
                    
                    <div class="analogy">
                        <p><strong>生活比喻：</strong> 就像你从家出发散步一圈又回到原点，中途至少有一个时刻你的瞬时速度为零（停下来喘口气）。</p>
                    </div>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="rolle-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>函数选择：</span>
                    <select id="rolle-function">
                        <option value="x^3-3x">f(x)=x³-3x (经典)</option>
                        <option value="sin(x)">f(x)=sin(x) (波浪)</option>
                        <option value="x^2">f(x)=x² (抛物线)</option>
                    </select>
                    <div>
                        <label>区间[a,b]: </label>
                        <input type="range" id="rolle-a" min="-2" max="1" step="0.1" value="-1.5" style="width: 80px;">
                        <span id="rolle-a-val">-1.5</span> 到 
                        <input type="range" id="rolle-b" min="0" max="3" step="0.1" value="1.5" style="width: 80px;">
                        <span id="rolle-b-val">1.5</span>
                    </div>
                    <button onclick="updateRolleGraph()">更新演示</button>
                </div>
                
                <div class="theorem">
                    <h3><i class="fas fa-user-graduate"></i> 拉格朗日中值定理 (Lagrange's Theorem) - "万能"的侦探</h3>
                    <p><strong>条件：</strong></p>
                    <ol>
                        <li>\( f(x) \) 在 \([a, b]\) 上连续</li>
                        <li>\( f(x) \) 在 \((a, b)\) 内可导</li>
                    </ol>
                    <p><strong>结论：</strong> 至少存在一点 \(\xi \in (a, b)\)，使得</p>
                    <div class="formula">
                        <p>\[ f'(\xi) = \frac{f(b) - f(a)}{b - a} \]</p>
                    </div>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="lagrange-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>函数选择：</span>
                    <select id="lagrange-function">
                        <option value="x^2">f(x)=x²</option>
                        <option value="sin(x)">f(x)=sin(x)</option>
                        <option value="e^x">f(x)=e^x</option>
                    </select>
                    <div>
                        <label>区间[a,b]: </label>
                        <input type="range" id="lagrange-a" min="-2" max="1" step="0.1" value="0" style="width: 80px;">
                        <span id="lagrange-a-val">0</span> 到 
                        <input type="range" id="lagrange-b" min="1" max="3" step="0.1" value="2" style="width: 80px;">
                        <span id="lagrange-b-val">2</span>
                    </div>
                    <button onclick="updateLagrangeGraph()">更新演示</button>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 1.1：罗尔定理的应用</h3>
                    <p>验证函数 \( f(x) = x^3 - 3x \) 在区间 \([-√3, √3]\) 上满足罗尔定理的条件，并求出定理中的 \(\xi\) 值。</p>
                    <button class="show-answer" onclick="toggleAnswer('answer1-1')">显示答案</button>
                    <div class="answer" id="answer1-1">
                        <p><strong>解：</strong></p>
                        <p>1. <strong>验证条件：</strong></p>
                        <p>• \( f(x) = x^3 - 3x \) 是多项式，在 \([-√3, √3]\) 上连续</p>
                        <p>• \( f'(x) = 3x^2 - 3 \)，在 \((-√3, √3)\) 内可导</p>
                        <p>• \( f(-√3) = (-√3)^3 - 3(-√3) = -3√3 + 3√3 = 0 \)</p>
                        <p>  \( f(√3) = (√3)^3 - 3(√3) = 3√3 - 3√3 = 0 \)</p>
                        <p>  所以 \( f(-√3) = f(√3) \)</p>
                        
                        <p>2. <strong>求 \(\xi\)：</strong> 由罗尔定理，存在 \(\xi \in (-√3, √3)\) 使得 \( f'(\xi) = 0 \)</p>
                        <p>  \( f'(\xi) = 3\xi^2 - 3 = 0 \) ⇒ \( \xi^2 = 1 \) ⇒ \( \xi = ±1 \)</p>
                        
                        <p><strong>结论：</strong> 罗尔定理成立，存在 \(\xi = -1\) 和 \(\xi = 1\) 使得 \( f'(\xi) = 0 \)。</p>
                    </div>
                </div>
                
                <div class="practice-card" style="margin: 20px 0;">
                    <h4>练习题 1.2</h4>
                    <p>对函数 \( f(x) = \ln x \) 在区间 \([1, e]\) 上应用拉格朗日中值定理，求定理中的 \(\xi\) 值。</p>
                    <button class="toggle-details" onclick="togglePracticeDetails('practice1-2')">查看解析</button>
                    <div class="details" id="practice1-2">
                        <p><strong>解析：</strong></p>
                        <p>1. <strong>验证条件：</strong></p>
                        <p>• \( f(x) = \ln x \) 在 \([1, e]\) 上连续</p>
                        <p>• \( f'(x) = \frac{1}{x} \)，在 \((1, e)\) 内可导</p>
                        
                        <p>2. <strong>计算：</strong></p>
                        <p>由拉格朗日中值定理：</p>
                        <p>\[ f'(\xi) = \frac{f(e) - f(1)}{e - 1} = \frac{\ln e - \ln 1}{e - 1} = \frac{1 - 0}{e - 1} = \frac{1}{e - 1} \]</p>
                        
                        <p>又 \( f'(\xi) = \frac{1}{\xi} \)，所以：</p>
                        <p>\[ \frac{1}{\xi} = \frac{1}{e - 1} \quad ⇒ \quad \xi = e - 1 \]</p>
                        
                        <p><strong>结论：</strong> 存在 \(\xi = e - 1\) 使得 \( f'(\xi) = \frac{1}{e - 1} \)。</p>
                    </div>
                </div>
            </section>
            
            <!-- 第二节：洛必达法则 -->
            <section class="card" id="section2">
                <h2><i class="fas fa-magic"></i> 第二节：洛必达法则 - 极限计算的"作弊器"</h2>
                
                <div class="history-fact">
                    <p><strong>洛必达的"买断"故事：</strong> 洛必达法则实际上是由约翰·伯努利发现的，但洛必达（法国贵族）花钱买下了伯努利的发现，并于1696年发表在自己的书中。这可能是数学史上最早的"知识付费"案例！</p>
                </div>
                
                <div class="theorem">
                    <h3><i class="fas fa-wand-magic-sparkles"></i> 洛必达法则 (L'Hôpital's Rule)</h3>
                    <p><strong>条件：</strong></p>
                    <ol>
                        <li>\(\lim_{x \to a} f(x) = \lim_{x \to a} g(x) = 0\) 或 \(\pm\infty\)（0/0型或∞/∞型）</li>
                        <li>在 \(a\) 的某去心邻域内，\(f'(x)\) 和 \(g'(x)\) 存在且 \(g'(x) \neq 0\)</li>
                        <li>\(\lim_{x \to a} \frac{f'(x)}{g'(x)}\) 存在或为无穷大</li>
                    </ol>
                    <p><strong>结论：</strong></p>
                    <div class="formula">
                        <p>\[ \lim_{x \to a} \frac{f(x)}{g(x)} = \lim_{x \to a} \frac{f'(x)}{g'(x)} \]</p>
                    </div>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="lhopital-graph"></canvas>
                    </div>
                </div>
                
                <div class="limit-graph-controls">
                    <div>
                        <span>极限类型：</span>
                        <select id="lhopital-type">
                            <option value="sinx/x">sin(x)/x (0/0型)</option>
                            <option value="lnx/x">ln(x)/x (∞/∞型)</option>
                            <option value="tanx-x/x^3">(tan x - x)/x³ (0/0型)</option>
                            <option value="1plus1/x^x">(1+1/x)^x (1^∞型)</option>
                        </select>
                    </div>
                    <div>
                        <span>趋近点：</span>
                        <select id="lhopital-point">
                            <option value="0">x→0</option>
                            <option value="inf">x→∞</option>
                            <option value="pi/2">x→π/2</option>
                        </select>
                        <button onclick="updateLHopitalGraph()">更新图形</button>
                    </div>
                    <div>
                        <span>当前极限值：</span>
                        <span id="limit-value" class="limit-value-display">计算中...</span>
                    </div>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 2.1：经典洛必达计算</h3>
                    <p>计算极限 \(\lim_{x \to 0} \frac{e^x - e^{-x} - 2x}{x - \sin x}\)</p>
                    <button class="show-answer" onclick="toggleAnswer('answer2-1')">显示答案</button>
                    <div class="answer" id="answer2-1">
                        <p><strong>解：</strong></p>
                        <p>1. <strong>判断类型：</strong> 当 \(x \to 0\) 时，分子分母都趋于0，是 0/0 型</p>
                        
                        <p>2. <strong>第一次洛必达：</strong></p>
                        <p>\[ \lim_{x \to 0} \frac{e^x - e^{-x} - 2x}{x - \sin x} = \lim_{x \to 0} \frac{e^x + e^{-x} - 2}{1 - \cos x} \]</p>
                        
                        <p>3. <strong>第二次洛必达：</strong> 还是 0/0 型</p>
                        <p>\[ = \lim_{x \to 0} \frac{e^x - e^{-x}}{\sin x} \]</p>
                        
                        <p>4. <strong>第三次洛必达：</strong> 还是 0/0 型</p>
                        <p>\[ = \lim_{x \to 0} \frac{e^x + e^{-x}}{\cos x} = \frac{1 + 1}{1} = 2 \]</p>
                        
                        <p><strong>结论：</strong> \(\lim_{x \to 0} \frac{e^x - e^{-x} - 2x}{x - \sin x} = 2\)</p>
                    </div>
                </div>
                
                <div class="practice-grid">
                    <div class="practice-card">
                        <h4>练习题 2.2</h4>
                        <p>计算极限 \(\lim_{x \to 0} \frac{\tan x - x}{x^3}\)</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice2-2')">查看解析</button>
                        <div class="details" id="practice2-2">
                            <p><strong>解析：</strong></p>
                            <p>1. 0/0型，使用洛必达法则：</p>
                            <p>\[ \lim_{x \to 0} \frac{\tan x - x}{x^3} = \lim_{x \to 0} \frac{\sec^2 x - 1}{3x^2} \]</p>
                            <p>2. 还是0/0型，继续洛必达：</p>
                            <p>\[ = \lim_{x \to 0} \frac{2\sec^2 x \tan x}{6x} = \lim_{x \to 0} \frac{\sec^2 x \tan x}{3x} \]</p>
                            <p>3. 再次洛必达：</p>
                            <p>\[ = \lim_{x \to 0} \frac{2\sec^2 x \tan^2 x + \sec^4 x}{3} = \frac{0+1}{3} = \frac{1}{3} \]</p>
                            <p><strong>答案：</strong> \(\frac{1}{3}\)</p>
                        </div>
                    </div>
                    
                    <div class="practice-card">
                        <h4>练习题 2.3</h4>
                        <p>计算极限 \(\lim_{x \to 0^+} x^x\)</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice2-3')">查看解析</button>
                        <div class="details" id="practice2-3">
                            <p><strong>解析：</strong> 这是 \(0^0\) 型未定式</p>
                            <p>1. 设 \(y = x^x\)，取对数：\(\ln y = x \ln x\)</p>
                            <p>2. 求极限：\(\lim_{x \to 0^+} x \ln x = \lim_{x \to 0^+} \frac{\ln x}{1/x}\) (∞/∞型)</p>
                            <p>3. 洛必达：\(\lim_{x \to 0^+} \frac{1/x}{-1/x^2} = \lim_{x \to 0^+} (-x) = 0\)</p>
                            <p>4. 所以 \(\lim_{x \to 0^+} \ln y = 0\)，故 \(\lim_{x \to 0^+} y = e^0 = 1\)</p>
                            <p><strong>答案：</strong> 1</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 第三节：函数性态研究 -->
            <section class="card" id="section3">
                <h2><i class="fas fa-chart-line"></i> 第三节：函数性态研究 - 函数的"人生轨迹"</h2>
                
                <div class="definition">
                    <h3><i class="fas fa-arrow-up"></i> 单调性判定定理</h3>
                    <p>设函数 \(f(x)\) 在区间 \(I\) 上可导：</p>
                    <ol>
                        <li>若 \(f'(x) > 0\) 在 \(I\) 上恒成立，则 \(f(x)\) 在 \(I\) 上严格单调递增</li>
                        <li>若 \(f'(x) < 0\) 在 \(I\) 上恒成立，则 \(f(x)\) 在 \(I\) 上严格单调递减</li>
                    </ol>
                </div>
                
                <div class="definition">
                    <h3><i class="fas fa-archway"></i> 凹凸性与拐点</h3>
                    <p><strong>凹凸性判定：</strong> 若 \(f''(x) > 0\)，则曲线是凹的（向上凸）；若 \(f''(x) < 0\)，则是凸的（向下凸）。</p>
                    <p><strong>拐点：</strong> 曲线凹凸性发生改变的点。</p>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="function-analysis-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>函数选择：</span>
                    <select id="analysis-function">
                        <option value="x^3-3x^2-9x+5">f(x)=x³-3x²-9x+5</option>
                        <option value="x^4-2x^2">f(x)=x⁴-2x²</option>
                        <option value="sin(x)">f(x)=sin(x)</option>
                        <option value="e^(-x^2/2)">f(x)=e^(-x²/2)</option>
                    </select>
                    <div>
                        <label>显示：</label>
                        <input type="checkbox" id="show-derivative" checked> 一阶导
                        <input type="checkbox" id="show-second-derivative"> 二阶导
                    </div>
                    <button onclick="updateAnalysisGraph()">更新分析</button>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 3.1：全面分析函数性态</h3>
                    <p>对函数 \(f(x) = x^3 - 3x^2 - 9x + 5\) 进行全面的性态分析，并描绘其图像。</p>
                    <button class="show-answer" onclick="toggleAnswer('answer3-1')">显示答案</button>
                    <div class="answer" id="answer3-1">
                        <p><strong>解：</strong></p>
                        
                        <p>1. <strong>一阶导数：</strong> \(f'(x) = 3x^2 - 6x - 9 = 3(x-3)(x+1)\)</p>
                        <p>令 \(f'(x) = 0\)，得 \(x_1 = -1\)，\(x_2 = 3\)</p>
                        
                        <p>2. <strong>二阶导数：</strong> \(f''(x) = 6x - 6 = 6(x-1)\)</p>
                        <p>令 \(f''(x) = 0\)，得 \(x = 1\)</p>
                        
                        <p>3. <strong>列表分析：</strong></p>
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>x</th>
                                    <th>(-∞, -1)</th>
                                    <th>-1</th>
                                    <th>(-1, 1)</th>
                                    <th>1</th>
                                    <th>(1, 3)</th>
                                    <th>3</th>
                                    <th>(3, +∞)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>f'(x)</td>
                                    <td>+</td>
                                    <td>0</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>0</td>
                                    <td>+</td>
                                </tr>
                                <tr>
                                    <td>f''(x)</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>0</td>
                                    <td>+</td>
                                    <td>+</td>
                                    <td>+</td>
                                </tr>
                                <tr>
                                    <td>单调性</td>
                                    <td>↗</td>
                                    <td>极大</td>
                                    <td>↘</td>
                                    <td>拐点</td>
                                    <td>↘</td>
                                    <td>极小</td>
                                    <td>↗</td>
                                </tr>
                                <tr>
                                    <td>凹凸性</td>
                                    <td>凸</td>
                                    <td>凸</td>
                                    <td>凸</td>
                                    <td>拐点</td>
                                    <td>凹</td>
                                    <td>凹</td>
                                    <td>凹</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <p>4. <strong>结论：</strong></p>
                        <p>• 单调递增区间：\((-∞, -1) \cup (3, +∞)\)</p>
                        <p>• 单调递减区间：\((-1, 3)\)</p>
                        <p>• 凹区间：\((1, +∞)\)</p>
                        <p>• 凸区间：\((-∞, 1)\)</p>
                        <p>• 拐点：\((1, f(1)) = (1, -6)\)</p>
                    </div>
                </div>
            </section>
            
            <!-- 第四节：极值与最值 -->
            <section class="card" id="section4">
                <h2><i class="fas fa-mountain"></i> 第四节：极值与最值 - 寻找函数的"巅峰"和"低谷"</h2>
                
                <div class="definition">
                    <h3><i class="fas fa-mountain"></i> 极值的定义与判定</h3>
                    <p><strong>极值必要条件（费马引理）：</strong> 如果 \(f(x)\) 在 \(x_0\) 处可导且取得极值，则 \(f'(x_0) = 0\)。</p>
                    
                    <p><strong>极值充分条件：</strong></p>
                    <ol>
                        <li><strong>第一充分条件：</strong> 通过 \(f'(x)\) 在 \(x_0\) 左右两侧的符号变化判断</li>
                        <li><strong>第二充分条件：</strong> 若 \(f'(x_0) = 0\)，\(f''(x_0) \neq 0\)，则
                            <ul>
                                <li>\(f''(x_0) > 0\) ⇒ \(f(x_0)\) 是极小值</li>
                                <li>\(f''(x_0) < 0\) ⇒ \(f(x_0)\) 是极大值</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="extrema-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>函数选择：</span>
                    <select id="extrema-function">
                        <option value="x^3-3x^2-9x+5">f(x)=x³-3x²-9x+5</option>
                        <option value="x^4-8x^2+2">f(x)=x⁴-8x²+2</option>
                        <option value="sin(x)+0.3x">f(x)=sin(x)+0.3x</option>
                        <option value="x+sqrt(1-x)">f(x)=x+√(1-x)</option>
                    </select>
                    <div>
                        <label>区间: </label>
                        <input type="range" id="extrema-a" min="-3" max="1" step="0.1" value="-2" style="width: 80px;">
                        <span id="extrema-a-val">-2</span> 到 
                        <input type="range" id="extrema-b" min="0" max="5" step="0.1" value="4" style="width: 80px;">
                        <span id="extrema-b-val">4</span>
                    </div>
                    <button onclick="updateExtremaGraph()">寻找极值最值</button>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 4.1：求极值与最值</h3>
                    <p>求函数 \(f(x) = x^3 - 3x^2 - 9x + 5\) 在区间 \([-2, 4]\) 上的极值和最值。</p>
                    <button class="show-answer" onclick="toggleAnswer('answer4-1')">显示答案</button>
                    <div class="answer" id="answer4-1">
                        <p><strong>解：</strong></p>
                        
                        <p>1. <strong>一阶导数：</strong> \(f'(x) = 3x^2 - 6x - 9 = 3(x-3)(x+1)\)</p>
                        <p>令 \(f'(x) = 0\)，得驻点：\(x_1 = -1\)，\(x_2 = 3\)</p>
                        
                        <p>2. <strong>二阶导数：</strong> \(f''(x) = 6x - 6\)</p>
                        <p>• \(f''(-1) = -12 < 0\) ⇒ \(x=-1\) 处取得极大值 \(f(-1)=10\)</p>
                        <p>• \(f''(3) = 12 > 0\) ⇒ \(x=3\) 处取得极小值 \(f(3)=-22\)</p>
                        
                        <p>3. <strong>计算端点值：</strong></p>
                        <p>• \(f(-2) = (-2)^3 - 3(-2)^2 - 9(-2) + 5 = -8 - 12 + 18 + 5 = 3\)</p>
                        <p>• \(f(4) = 64 - 48 - 36 + 5 = -15\)</p>
                        
                        <p>4. <strong>比较：</strong></p>
                        <p>函数值：\(f(-2)=3\)，\(f(-1)=10\)，\(f(3)=-22\)，\(f(4)=-15\)</p>
                        <p>• 最大值：\(10\) (在 \(x=-1\) 处)</p>
                        <p>• 最小值：\(-22\) (在 \(x=3\) 处)</p>
                    </div>
                </div>
                
                <div class="practice-grid">
                    <div class="practice-card">
                        <h4>练习题 4.2</h4>
                        <p>求函数 \(f(x) = x^4 - 8x^2 + 2\) 的极值。</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice4-2')">查看解析</button>
                        <div class="details" id="practice4-2">
                            <p><strong>解析：</strong></p>
                            <p>1. \(f'(x) = 4x^3 - 16x = 4x(x^2 - 4) = 4x(x-2)(x+2)\)</p>
                            <p>2. 驻点：\(x=0, ±2\)</p>
                            <p>3. \(f''(x) = 12x^2 - 16\)</p>
                            <p>• \(f''(-2) = 48-16=32>0\) ⇒ 极小值 \(f(-2)= -14\)</p>
                            <p>• \(f''(0) = -16<0\) ⇒ 极大值 \(f(0)= 2\)</p>
                            <p>• \(f''(2) = 48-16=32>0\) ⇒ 极小值 \(f(2)= -14\)</p>
                            <p><strong>答案：</strong> 极大值2，极小值-14</p>
                        </div>
                    </div>
                    
                    <div class="practice-card">
                        <h4>练习题 4.3（应用题）</h4>
                        <p>要制造一个容积为 \(V\) 的圆柱形罐头盒，问底面半径 \(r\) 和高 \(h\) 成什么比例时，所用材料最省？</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice4-3')">查看解析</button>
                        <div class="details" id="practice4-3">
                            <p><strong>解析：</strong></p>
                            <p>1. 设底面半径 \(r\)，高 \(h\)，容积 \(V = πr^2h\) ⇒ \(h = \frac{V}{πr^2}\)</p>
                            <p>2. 表面积 \(S = 2πr^2 + 2πrh = 2πr^2 + \frac{2V}{r}\)</p>
                            <p>3. \(S'(r) = 4πr - \frac{2V}{r^2}\)，令 \(S'(r)=0\) ⇒ \(r^3 = \frac{V}{2π}\)</p>
                            <p>4. \(S''(r) = 4π + \frac{4V}{r^3} > 0\)，所以是最小值</p>
                            <p>5. 此时 \(h = 2r\)</p>
                            <p><strong>答案：</strong> 当 \(h=2r\) 时材料最省</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 第五节：弧微分与曲率 -->
            <section class="card" id="section5">
                <h2><i class="fas fa-ruler-combined"></i> 第五节：弧微分与曲率 - 曲线的"弯曲程度"</h2>
                
                <div class="curvature-container">
                    <h3><i class="fas fa-ruler"></i> 弧微分公式</h3>
                    <p>对于曲线 \(y = f(x)\)，弧微分 \(ds\) 为：</p>
                    <div class="formula">
                        <p>\[ ds = \sqrt{1 + [f'(x)]^2} \, dx \]</p>
                    </div>
                </div>
                
                <div class="curvature-container">
                    <h3><i class="fas fa-curve"></i> 曲率公式</h3>
                    <p>曲线 \(y = f(x)\) 在点 \(x\) 处的曲率 \(K\) 为：</p>
                    <div class="formula">
                        <p>\[ K = \frac{|y''|}{(1 + y'^2)^{3/2}} \]</p>
                    </div>
                    <p><strong>曲率半径：</strong> \(R = \frac{1}{K}\)</p>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="curvature-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>曲线选择：</span>
                    <select id="curvature-function">
                        <option value="x^2">抛物线 y=x²</option>
                        <option value="sin(x)">正弦曲线 y=sin(x)</option>
                        <option value="e^x">指数曲线 y=e^x</option>
                        <option value="ln(x)">对数曲线 y=ln(x)</option>
                    </select>
                    <div>
                        <label>考察点 x: </label>
                        <input type="range" id="curvature-x" min="-2" max="2" step="0.1" value="1" style="width: 100px;">
                        <span id="curvature-x-val">1.0</span>
                    </div>
                    <button onclick="updateCurvatureGraph()">计算曲率</button>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 5.1：曲率计算</h3>
                    <p>求曲线 \(y = \ln x\) 在点 \((1, 0)\) 处的曲率。</p>
                    <button class="show-answer" onclick="toggleAnswer('answer5-1')">显示答案</button>
                    <div class="answer" id="answer5-1">
                        <p><strong>解：</strong></p>
                        <p>1. 求导：\(y' = \frac{1}{x}\)，\(y'' = -\frac{1}{x^2}\)</p>
                        <p>2. 在点 \((1, 0)\) 处：\(y'(1) = 1\)，\(y''(1) = -1\)</p>
                        <p>3. 曲率公式：\(K = \frac{|y''|}{(1 + y'^2)^{3/2}}\)</p>
                        <p>4. 代入：\(K = \frac{|-1|}{(1 + 1^2)^{3/2}} = \frac{1}{(2)^{3/2}} = \frac{1}{2\sqrt{2}} = \frac{\sqrt{2}}{4}\)</p>
                        <p>5. 曲率半径：\(R = \frac{1}{K} = 2\sqrt{2}\)</p>
                        
                        <p><strong>结论：</strong> 曲率 \(K = \frac{\sqrt{2}}{4}\)，曲率半径 \(R = 2\sqrt{2}\)。</p>
                    </div>
                </div>
                
                <div class="practice-grid">
                    <div class="practice-card">
                        <h4>练习题 5.2</h4>
                        <p>求抛物线 \(y = x^2\) 在点 \((1, 1)\) 处的曲率。</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice5-2')">查看解析</button>
                        <div class="details" id="practice5-2">
                            <p><strong>解析：</strong></p>
                            <p>1. \(y' = 2x\)，\(y'' = 2\)</p>
                            <p>2. 在 \(x=1\) 处：\(y'(1)=2\)，\(y''(1)=2\)</p>
                            <p>3. \(K = \frac{|2|}{(1+4)^{3/2}} = \frac{2}{5^{3/2}} = \frac{2}{5\sqrt{5}} = \frac{2\sqrt{5}}{25}\)</p>
                            <p><strong>答案：</strong> \(K = \frac{2\sqrt{5}}{25}\)</p>
                        </div>
                    </div>
                    
                    <div class="practice-card">
                        <h4>练习题 5.3</h4>
                        <p>求圆 \(x^2 + y^2 = R^2\) 上任意一点的曲率。</p>
                        <button class="toggle-details" onclick="togglePracticeDetails('practice5-3')">查看解析</button>
                        <div class="details" id="practice5-3">
                            <p><strong>解析：</strong></p>
                            <p>1. 隐函数求导：\(2x + 2yy' = 0\) ⇒ \(y' = -\frac{x}{y}\)</p>
                            <p>2. 再次求导：\(y'' = -\frac{y^2+x^2}{y^3} = -\frac{R^2}{y^3}\)</p>
                            <p>3. 曲率：\(K = \frac{|y''|}{(1+y'^2)^{3/2}} = \frac{R^2/|y|^3}{(\frac{R^2}{y^2})^{3/2}} = \frac{R^2/|y|^3}{R^3/|y|^3} = \frac{1}{R}\)</p>
                            <p><strong>答案：</strong> 圆上任意点的曲率都是常数 \(K = \frac{1}{R}\)</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 第六节：泰勒公式 -->
            <section class="card" id="section6">
                <h2><i class="fas fa-layer-group"></i> 第六节：泰勒公式 - 函数的"美颜相机"</h2>
                
                <div class="theorem">
                    <h3><i class="fas fa-expand-alt"></i> 泰勒公式 (Taylor's Formula)</h3>
                    <p>如果函数 \(f(x)\) 在 \(x_0\) 处具有 \(n+1\) 阶导数，则对于 \(x_0\) 附近的 \(x\)，有：</p>
                    <div class="formula">
                        <p>\[ f(x) = f(x_0) + f'(x_0)(x-x_0) + \frac{f''(x_0)}{2!}(x-x_0)^2 + \cdots + \frac{f^{(n)}(x_0)}{n!}(x-x_0)^n + R_n(x) \]</p>
                    </div>
                    <p>当 \(x_0 = 0\) 时，称为麦克劳林公式。</p>
                </div>
                
                <div class="graph-container">
                    <div class="canvas-container">
                        <canvas id="taylor-graph"></canvas>
                    </div>
                </div>
                
                <div class="graph-controls">
                    <span>函数选择：</span>
                    <select id="taylor-function">
                        <option value="sin(x)">sin(x)</option>
                        <option value="cos(x)">cos(x)</option>
                        <option value="e^x">e^x</option>
                        <option value="ln(1+x)">ln(1+x)</option>
                    </select>
                    <div>
                        <label>展开阶数 n: </label>
                        <input type="range" id="taylor-n" min="1" max="10" step="1" value="3" style="width: 100px;">
                        <span id="taylor-n-val">3</span>
                    </div>
                    <div>
                        <label>展开中心 x₀: </label>
                        <input type="range" id="taylor-x0" min="-2" max="2" step="0.1" value="0" style="width: 80px;">
                        <span id="taylor-x0-val">0</span>
                    </div>
                    <button onclick="updateTaylorGraph()">更新逼近</button>
                </div>
                
                <div class="exercise">
                    <h3><i class="fas fa-pencil-alt"></i> 练习题 6.1：泰勒展开求极限</h3>
                    <p>利用泰勒展开计算极限 \(\lim_{x \to 0} \frac{\cos x - e^{-\frac{x^2}{2}}}{x^4}\)</p>
                    <button class="show-answer" onclick="toggleAnswer('answer6-1')">显示答案</button>
                    <div class="answer" id="answer6-1">
                        <p><strong>解：</strong></p>
                        
                        <p>1. <strong>写出 \(\cos x\) 的展开：</strong></p>
                        <p>\[ \cos x = 1 - \frac{x^2}{2!} + \frac{x^4}{4!} + o(x^4) = 1 - \frac{x^2}{2} + \frac{x^4}{24} + o(x^4) \]</p>
                        
                        <p>2. <strong>写出 \(e^{-\frac{x^2}{2}}\) 的展开：</strong></p>
                        <p>令 \(u = -\frac{x^2}{2}\)，则 \(e^u = 1 + u + \frac{u^2}{2!} + o(u^2)\)</p>
                        <p>所以 \(e^{-\frac{x^2}{2}} = 1 - \frac{x^2}{2} + \frac{(-x^2/2)^2}{2} + o(x^4) = 1 - \frac{x^2}{2} + \frac{x^4}{8} + o(x^4)\)</p>
                        
                        <p>3. <strong>代入原极限：</strong></p>
                        <p>\[ \cos x - e^{-\frac{x^2}{2}} = \left(1 - \frac{x^2}{2} + \frac{x^4}{24} + o(x^4)\right) - \left(1 - \frac{x^2}{2} + \frac{x^4}{8} + o(x^4)\right) \]</p>
                        <p>\[ = \frac{x^4}{24} - \frac{x^4}{8} + o(x^4) = -\frac{x^4}{12} + o(x^4) \]</p>
                        
                        <p>4. <strong>计算极限：</strong></p>
                        <p>\[ \lim_{x \to 0} \frac{\cos x - e^{-\frac{x^2}{2}}}{x^4} = \lim_{x \to 0} \frac{-\frac{x^4}{12} + o(x^4)}{x^4} = -\frac{1}{12} \]</p>
                        
                        <p><strong>结论：</strong> \(\lim_{x \to 0} \frac{\cos x - e^{-\frac{x^2}{2}}}{x^4} = -\frac{1}{12}\)</p>
                    </div>
                </div>
            </section>
        </main>
        
        <aside class="sidebar">
            <h2><i class="fas fa-list"></i> 章节导航</h2>
            <ul class="chapter-nav">
                <li><a href="#section1" class="active"><i class="fas fa-balance-scale"></i> 中值定理</a></li>
                <li><a href="#section2"><i class="fas fa-magic"></i> 洛必达法则</a></li>
                <li><a href="#section3"><i class="fas fa-chart-line"></i> 函数性态</a></li>
                <li><a href="#section4"><i class="fas fa-mountain"></i> 极值最值</a></li>
                <li><a href="#section5"><i class="fas fa-ruler-combined"></i> 弧微分曲率</a></li>
                <li><a href="#section6"><i class="fas fa-layer-group"></i> 泰勒公式</a></li>
            </ul>
            
            <h2 style="margin-top: 40px;"><i class="fas fa-lightbulb"></i> 核心公式总结</h2>
            <div class="definition" style="margin-top: 15px; font-size: 0.9rem;">
                <p><strong>拉格朗日中值定理：</strong></p>
                <p>\( f'(\xi) = \frac{f(b)-f(a)}{b-a} \)</p>
                
                <p><strong>洛必达法则：</strong></p>
                <p>\( \lim \frac{f(x)}{g(x)} = \lim \frac{f'(x)}{g'(x)} \)</p>
                
                <p><strong>曲率公式：</strong></p>
                <p>\( K = \frac{|y''|}{(1+y'^2)^{3/2}} \)</p>
                
                <p><strong>泰勒公式：</strong></p>
                <p>\( f(x) = \sum_{k=0}^n \frac{f^{(k)}(x_0)}{k!}(x-x_0)^k + R_n(x) \)</p>
            </div>
            
            <h2 style="margin-top: 40px;"><i class="fas fa-check-circle"></i> 学习进度</h2>
            <div class="exercise" style="margin-top: 15px;">
                <p id="mastered-list">尚未掌握任何知识点</p>
                <p>已掌握: <span id="mastered-display">0</span>/24 个知识点</p>
                <button class="btn" onclick="checkAllKnowledge()" style="width:100%; margin-top:15px;">全面检测</button>
            </div>
            
            <h2 style="margin-top: 40px;"><i class="fas fa-gamepad"></i> 快速测试</h2>
            <div class="exercise" style="margin-top: 15px;">
                <p>判断对错：</p>
                <p>1. 可导⇒连续，连续⇏可导 ( )</p>
                <p>2. 极值点一定是驻点 ( )</p>
                <p>3. 洛必达适用于所有极限 ( )</p>
                <p>4. 圆的曲率是常数 ( )</p>
                <button class="show-answer" onclick="showQuickTestAnswers()" style="width:100%;">查看答案</button>
                <div id="quick-test-answers" class="answer"></div>
            </div>
        </aside>
    </div>
    
    <footer>
        <p>© 2023 高等数学学习助手 | 同济大学第七版/第八版上册第三章：微分中值定理与导数的应用</p>
        <p>注：本内容包含动态图形演示、知识点全面覆盖、幽默风趣讲解</p>
    </footer>

    <script>
        // 初始化掌握状态
        let masteredSections = new Set();
        
        // 更新进度条
        function updateProgress() {
            const sections = document.querySelectorAll('.card');
            const currentSection = document.querySelector('.card:target') || sections[0];
            const sectionIndex = Array.from(sections).indexOf(currentSection);
            const progress = ((sectionIndex + 1) / sections.length) * 100;
            
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress-text').textContent = Math.round(progress) + '%';
            
            // 更新导航活动状态
            document.querySelectorAll('.chapter-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`.chapter-nav a[href="#${currentSection.id}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // 更新掌握数量
            updateMasteredCount();
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            initSliders();
            initAllGraphs();
            
            // 为每节添加标记按钮
            document.querySelectorAll('.card').forEach((card, index) => {
                const sectionId = card.id;
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerHTML = '<i class="fas fa-check-circle"></i> 标记本节为已掌握';
                btn.onclick = function() { markAsMastered(sectionId); };
                card.appendChild(btn);
            });
        });
        
        // 监听hash变化
        window.addEventListener('hashchange', updateProgress);
        
        // 初始化滑动条
        function initSliders() {
            // 罗尔定理滑动条
            const rolleA = document.getElementById('rolle-a');
            const rolleAVal = document.getElementById('rolle-a-val');
            const rolleB = document.getElementById('rolle-b');
            const rolleBVal = document.getElementById('rolle-b-val');
            
            rolleA.addEventListener('input', function() {
                rolleAVal.textContent = this.value;
                if (parseFloat(this.value) >= parseFloat(rolleB.value)) {
                    this.value = parseFloat(rolleB.value) - 0.1;
                    rolleAVal.textContent = this.value;
                }
                updateRolleGraph();
            });
            
            rolleB.addEventListener('input', function() {
                rolleBVal.textContent = this.value;
                if (parseFloat(this.value) <= parseFloat(rolleA.value)) {
                    this.value = parseFloat(rolleA.value) + 0.1;
                    rolleBVal.textContent = this.value;
                }
                updateRolleGraph();
            });
            
            // 拉格朗日定理滑动条
            const lagrangeA = document.getElementById('lagrange-a');
            const lagrangeAVal = document.getElementById('lagrange-a-val');
            const lagrangeB = document.getElementById('lagrange-b');
            const lagrangeBVal = document.getElementById('lagrange-b-val');
            
            lagrangeA.addEventListener('input', function() {
                lagrangeAVal.textContent = this.value;
                updateLagrangeGraph();
            });
            
            lagrangeB.addEventListener('input', function() {
                lagrangeBVal.textContent = this.value;
                updateLagrangeGraph();
            });
            
            // 其他滑动条类似...
        }
        
        // 初始化所有图形
        function initAllGraphs() {
            updateRolleGraph();
            updateLagrangeGraph();
            updateLHopitalGraph();
            updateAnalysisGraph();
            updateExtremaGraph();
            updateCurvatureGraph();
            updateTaylorGraph();
        }
        
        // 显示/隐藏答案
        function toggleAnswer(answerId) {
            const answer = document.getElementById(answerId);
            answer.classList.toggle('show');
            const button = event.target;
            button.textContent = answer.classList.contains('show') ? '隐藏答案' : '显示答案';
        }
        
        // 显示/隐藏练习题解析
        function togglePracticeDetails(detailsId) {
            const details = document.getElementById(detailsId);
            details.classList.toggle('show');
            const button = event.target;
            button.textContent = details.classList.contains('show') ? '隐藏解析' : '查看解析';
        }
        
        // 标记为已掌握
        function markAsMastered(sectionId) {
            masteredSections.add(sectionId);
            updateMasteredCount();
            
            const button = event.target;
            button.innerHTML = '<i class="fas fa-check-double"></i> 已掌握';
            button.style.background = '#4CAF50';
            button.onclick = null;
            
            alert('恭喜！你已经掌握了这一节的核心内容！');
        }
        
        // 更新掌握数量显示
        function updateMasteredCount() {
            const totalSections = 6;
            const mastered = masteredSections.size;
            document.getElementById('mastered-count').textContent = mastered * 4;
            document.getElementById('mastered-display').textContent = mastered * 4;
            
            const masteredList = document.getElementById('mastered-list');
            if (mastered === 0) {
                masteredList.textContent = '尚未掌握任何知识点';
                masteredList.style.color = '#666';
            } else {
                let listText = '已掌握: ';
                const sections = ['中值定理', '洛必达法则', '函数性态', '极值最值', '弧微分曲率', '泰勒公式'];
                sections.forEach((name, i) => {
                    if (masteredSections.has(`section${i+1}`)) {
                        listText += name + '、';
                    }
                });
                masteredList.textContent = listText.slice(0, -1);
                masteredList.style.color = '#4CAF50';
            }
        }
        
        // 全面检测
        function checkAllKnowledge() {
            const questions = [
                "1. 罗尔定理的三个条件是什么？",
                "2. 洛必达法则适用于哪些未定式？",
                "3. 如何用导数判断函数的单调性？",
                "4. 如何求函数的极值和最值？",
                "5. 曲率公式是什么？",
                "6. 泰勒公式的核心思想是什么？"
            ];
            
            let message = "第三章核心知识点检测：\n\n";
            questions.forEach((q, i) => {
                message += q + "\n\n";
            });
            
            message += `你的掌握情况：${masteredSections.size * 4}/24 个知识点\n`;
            if (masteredSections.size >= 5) {
                message += "优秀！你对本章内容掌握得很好！";
            } else if (masteredSections.size >= 3) {
                message += "不错，但还需要加强对部分内容的理解！";
            } else {
                message += "加油，需要更多练习和复习！";
            }
            
            alert(message);
        }
        
        // 快速测试答案
        function showQuickTestAnswers() {
            const answers = [
                "1. 可导⇒连续，连续⇏可导 (✓)",
                "2. 极值点一定是驻点 (✗) 可导函数的极值点是驻点",
                "3. 洛必达适用于所有极限 (✗) 只适用于0/0或∞/∞型",
                "4. 圆的曲率是常数 (✓) K=1/R"
            ];
            
            const container = document.getElementById('quick-test-answers');
            container.innerHTML = answers.join('<br>');
            container.classList.add('show');
        }
        
        // ==================== 图形绘制函数 ====================
        
        // 罗尔定理图形
        let rolleChart = null;
        
        function updateRolleGraph() {
            const functionType = document.getElementById('rolle-function').value;
            const a = parseFloat(document.getElementById('rolle-a').value);
            const b = parseFloat(document.getElementById('rolle-b').value);
            
            let func, derivative, funcName;
            
            switch(functionType) {
                case 'x^3-3x':
                    func = x => x*x*x - 3*x;
                    derivative = x => 3*x*x - 3;
                    funcName = 'f(x)=x³-3x';
                    break;
                case 'sin(x)':
                    func = x => Math.sin(x);
                    derivative = x => Math.cos(x);
                    funcName = 'f(x)=sin(x)';
                    break;
                case 'x^2':
                    func = x => x*x;
                    derivative = x => 2*x;
                    funcName = 'f(x)=x²';
                    break;
            }
            
            const fa = func(a);
            const fb = func(b);
            const satisfiesRolle = Math.abs(fa - fb) < 0.001;
            
            // 生成数据
            const labels = [];
            const data = [];
            const secantData = [];
            
            const xMin = Math.min(a, b) - 1;
            const xMax = Math.max(a, b) + 1;
            
            for (let x = xMin; x <= xMax; x += 0.1) {
                labels.push(x.toFixed(1));
                data.push(func(x));
                
                // 割线数据
                if (x >= a && x <= b) {
                    const secantY = fa + (fb - fa) * (x - a) / (b - a);
                    secantData.push(secantY);
                } else {
                    secantData.push(null);
                }
            }
            
            const ctx = document.getElementById('rolle-graph').getContext('2d');
            
            if (rolleChart) {
                rolleChart.destroy();
            }
            
            rolleChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: '割线',
                        data: secantData,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'f(x)'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `f(a)=${fa.toFixed(2)}, f(b)=${fb.toFixed(2)}, ${satisfiesRolle ? '满足罗尔定理条件' : '不满足f(a)=f(b)'}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
        }
        
        // 拉格朗日定理图形
        let lagrangeChart = null;
        
        function updateLagrangeGraph() {
            const functionType = document.getElementById('lagrange-function').value;
            const a = parseFloat(document.getElementById('lagrange-a').value);
            const b = parseFloat(document.getElementById('lagrange-b').value);
            
            let func, derivative, funcName;
            
            switch(functionType) {
                case 'x^2':
                    func = x => x*x;
                    derivative = x => 2*x;
                    funcName = 'f(x)=x²';
                    break;
                case 'sin(x)':
                    func = x => Math.sin(x);
                    derivative = x => Math.cos(x);
                    funcName = 'f(x)=sin(x)';
                    break;
                case 'e^x':
                    func = x => Math.exp(x);
                    derivative = x => Math.exp(x);
                    funcName = 'f(x)=e^x';
                    break;
            }
            
            const fa = func(a);
            const fb = func(b);
            const secantSlope = (fb - fa) / (b - a);
            
            // 找导数等于割线斜率的点
            let tangentX = null;
            for (let x = a; x <= b; x += 0.01) {
                if (Math.abs(derivative(x) - secantSlope) < 0.05) {
                    tangentX = x;
                    break;
                }
            }
            
            // 生成数据
            const labels = [];
            const data = [];
            const secantData = [];
            const tangentData = [];
            
            const xMin = Math.min(a, b) - 0.5;
            const xMax = Math.max(a, b) + 0.5;
            
            for (let x = xMin; x <= xMax; x += 0.1) {
                labels.push(x.toFixed(1));
                data.push(func(x));
                
                // 割线数据
                if (x >= a && x <= b) {
                    const secantY = fa + secantSlope * (x - a);
                    secantData.push(secantY);
                } else {
                    secantData.push(null);
                }
                
                // 切线数据
                tangentData.push(null);
            }
            
            const ctx = document.getElementById('lagrange-graph').getContext('2d');
            
            if (lagrangeChart) {
                lagrangeChart.destroy();
            }
            
            lagrangeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: '割线',
                        data: secantData,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }, {
                        label: '切线',
                        data: tangentData,
                        borderColor: '#4cc9f0',
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'f(x)'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `割线斜率 = ${secantSlope.toFixed(2)}${tangentX ? `, 存在ξ=${tangentX.toFixed(2)}使f'(ξ)=${secantSlope.toFixed(2)}` : ''}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
            
            // 绘制切线
            if (tangentX !== null) {
                const tangentY = func(tangentX);
                const tangentSlope = derivative(tangentX);
                
                for (let i = 0; i < labels.length; i++) {
                    const x = xMin + i * 0.1;
                    if (Math.abs(x - tangentX) < 1) {
                        const y = tangentY + tangentSlope * (x - tangentX);
                        lagrangeChart.data.datasets[2].data[i] = y;
                    }
                }
                
                lagrangeChart.update();
            }
        }
        
        // 洛必达法则图形
        let lhopitalChart = null;
        
        function updateLHopitalGraph() {
            const type = document.getElementById('lhopital-type').value;
            const point = document.getElementById('lhopital-point').value;
            
            let func, limitValue, funcName;
            let xMin, xMax, x0;
            
            switch(point) {
                case '0': x0 = 0; xMin = -1.5; xMax = 1.5; break;
                case 'inf': x0 = Infinity; xMin = 1; xMax = 20; break;
                case 'pi/2': x0 = Math.PI/2; xMin = 1; xMax = 2.5; break;
            }
            
            switch(type) {
                case 'sinx/x':
                    func = x => Math.sin(x) / x;
                    limitValue = 1;
                    funcName = 'sin(x)/x';
                    if (point === 'inf') {
                        func = x => Math.sin(1/x) / (1/x);
                        xMin = 0.05; xMax = 2;
                    }
                    break;
                case 'lnx/x':
                    func = x => Math.log(x) / x;
                    limitValue = 0;
                    funcName = 'ln(x)/x';
                    break;
                case 'tanx-x/x^3':
                    func = x => (Math.tan(x) - x) / (x*x*x);
                    limitValue = 1/3;
                    funcName = '(tan x - x)/x³';
                    break;
                case '1plus1/x^x':
                    func = x => Math.pow(1 + 1/x, x);
                    limitValue = Math.E;
                    funcName = '(1+1/x)^x';
                    xMin = 1; xMax = 20;
                    break;
            }
            
            // 生成数据
            const labels = [];
            const data = [];
            const limitLine = [];
            
            const step = (xMax - xMin) / 100;
            for (let i = 0; i <= 100; i++) {
                let x;
                if (point === 'inf') {
                    x = xMin + i * step;
                } else {
                    x = xMin + i * step;
                }
                
                if (x === 0 && type === 'sinx/x') {
                    labels.push('0');
                    data.push(1); // sin(x)/x在0处的极限为1
                } else if (x <= 0 && type === 'lnx/x') {
                    labels.push(x.toFixed(2));
                    data.push(null);
                } else {
                    labels.push(x.toFixed(2));
                    data.push(func(x));
                }
                
                limitLine.push(limitValue);
            }
            
            const ctx = document.getElementById('lhopital-graph').getContext('2d');
            
            if (lhopitalChart) {
                lhopitalChart.destroy();
            }
            
            lhopitalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1,
                        pointRadius: 0
                    }, {
                        label: `极限值 = ${limitValue.toFixed(4)}`,
                        data: limitLine,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '函数值'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `lim(x→${point==='inf'?'∞':point}) ${funcName} = ${limitValue.toFixed(4)}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
            
            document.getElementById('limit-value').textContent = limitValue.toFixed(4);
        }
        
        // 函数性态分析图形
        let analysisChart = null;
        
        function updateAnalysisGraph() {
            const functionType = document.getElementById('analysis-function').value;
            const showDerivative = document.getElementById('show-derivative').checked;
            const showSecondDerivative = document.getElementById('show-second-derivative').checked;
            
            let func, derivative, secondDerivative, funcName;
            
            switch(functionType) {
                case 'x^3-3x^2-9x+5':
                    func = x => x*x*x - 3*x*x - 9*x + 5;
                    derivative = x => 3*x*x - 6*x - 9;
                    secondDerivative = x => 6*x - 6;
                    funcName = 'f(x)=x³-3x²-9x+5';
                    break;
                case 'x^4-2x^2':
                    func = x => x*x*x*x - 2*x*x;
                    derivative = x => 4*x*x*x - 4*x;
                    secondDerivative = x => 12*x*x - 4;
                    funcName = 'f(x)=x⁴-2x²';
                    break;
                case 'sin(x)':
                    func = x => Math.sin(x);
                    derivative = x => Math.cos(x);
                    secondDerivative = x => -Math.sin(x);
                    funcName = 'f(x)=sin(x)';
                    break;
                case 'e^(-x^2/2)':
                    func = x => Math.exp(-x*x/2);
                    derivative = x => -x * Math.exp(-x*x/2);
                    secondDerivative = x => (x*x - 1) * Math.exp(-x*x/2);
                    funcName = 'f(x)=e^(-x²/2)';
                    break;
            }
            
            // 生成数据
            const labels = [];
            const funcData = [];
            const derivativeData = [];
            const secondDerivativeData = [];
            
            const xMin = -3, xMax = 3;
            
            for (let i = 0; i <= 100; i++) {
                const x = xMin + i * (xMax - xMin) / 100;
                labels.push(x.toFixed(1));
                
                funcData.push(func(x));
                derivativeData.push(showDerivative ? derivative(x) : null);
                secondDerivativeData.push(showSecondDerivative ? secondDerivative(x) : null);
            }
            
            const ctx = document.getElementById('function-analysis-graph').getContext('2d');
            
            if (analysisChart) {
                analysisChart.destroy();
            }
            
            analysisChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: funcData,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: "f'(x)",
                        data: derivativeData,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [3, 3],
                        fill: false,
                        tension: 0.1,
                        pointRadius: 0
                    }, {
                        label: "f''(x)",
                        data: secondDerivativeData,
                        borderColor: '#4cc9f0',
                        borderWidth: 2,
                        borderDash: [2, 4],
                        fill: false,
                        tension: 0.1,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'y'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `函数性态分析: ${funcName}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
        }
        
        // 极值与最值图形
        let extremaChart = null;
        
        function updateExtremaGraph() {
            const functionType = document.getElementById('extrema-function').value;
            const a = parseFloat(document.getElementById('extrema-a').value);
            const b = parseFloat(document.getElementById('extrema-b').value);
            
            document.getElementById('extrema-a-val').textContent = a;
            document.getElementById('extrema-b-val').textContent = b;
            
            let func, derivative, secondDerivative, funcName;
            
            switch(functionType) {
                case 'x^3-3x^2-9x+5':
                    func = x => x*x*x - 3*x*x - 9*x + 5;
                    derivative = x => 3*x*x - 6*x - 9;
                    secondDerivative = x => 6*x - 6;
                    funcName = 'f(x)=x³-3x²-9x+5';
                    break;
                case 'x^4-8x^2+2':
                    func = x => x*x*x*x - 8*x*x + 2;
                    derivative = x => 4*x*x*x - 16*x;
                    secondDerivative = x => 12*x*x - 16;
                    funcName = 'f(x)=x⁴-8x²+2';
                    break;
                case 'sin(x)+0.3x':
                    func = x => Math.sin(x) + 0.3*x;
                    derivative = x => Math.cos(x) + 0.3;
                    secondDerivative = x => -Math.sin(x);
                    funcName = 'f(x)=sin(x)+0.3x';
                    break;
                case 'x+sqrt(1-x)':
                    func = x => x + Math.sqrt(1 - x);
                    derivative = x => 1 - 1/(2*Math.sqrt(1-x));
                    secondDerivative = x => -1/(4*Math.pow(1-x, 1.5));
                    funcName = 'f(x)=x+√(1-x)';
                    break;
            }
            
            // 找极值点
            const criticalPoints = [];
            for (let x = a; x <= b; x += 0.01) {
                if (Math.abs(derivative(x)) < 0.05) {
                    const type = secondDerivative(x) > 0 ? '极小值' : (secondDerivative(x) < 0 ? '极大值' : '驻点');
                    criticalPoints.push({x, y: func(x), type});
                }
            }
            
            // 找最值
            let minVal = Infinity, maxVal = -Infinity;
            let minPoint = null, maxPoint = null;
            
            // 检查端点
            const fa = func(a), fb = func(b);
            if (fa < minVal) { minVal = fa; minPoint = {x: a, y: fa, type: '端点'}; }
            if (fa > maxVal) { maxVal = fa; maxPoint = {x: a, y: fa, type: '端点'}; }
            if (fb < minVal) { minVal = fb; minPoint = {x: b, y: fb, type: '端点'}; }
            if (fb > maxVal) { maxVal = fb; maxPoint = {x: b, y: fb, type: '端点'}; }
            
            // 检查极值点
            criticalPoints.forEach(p => {
                if (p.y < minVal) { minVal = p.y; minPoint = p; }
                if (p.y > maxVal) { maxVal = p.y; maxPoint = p; }
            });
            
            // 生成数据
            const labels = [];
            const data = [];
            
            const xMin = Math.min(a, b) - 0.5;
            const xMax = Math.max(a, b) + 0.5;
            
            for (let x = xMin; x <= xMax; x += 0.1) {
                labels.push(x.toFixed(1));
                data.push(func(x));
            }
            
            const ctx = document.getElementById('extrema-graph').getContext('2d');
            
            if (extremaChart) {
                extremaChart.destroy();
            }
            
            extremaChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: '极大值点',
                        data: Array(labels.length).fill(null),
                        backgroundColor: '#f72585',
                        borderColor: '#f72585',
                        borderWidth: 0,
                        pointRadius: 6,
                        pointBackgroundColor: '#f72585'
                    }, {
                        label: '极小值点',
                        data: Array(labels.length).fill(null),
                        backgroundColor: '#4cc9f0',
                        borderColor: '#4cc9f0',
                        borderWidth: 0,
                        pointRadius: 6,
                        pointBackgroundColor: '#4cc9f0'
                    }, {
                        label: '最值点',
                        data: Array(labels.length).fill(null),
                        backgroundColor: '#f8961e',
                        borderColor: '#f8961e',
                        borderWidth: 0,
                        pointRadius: 8,
                        pointBackgroundColor: '#f8961e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'f(x)'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `最大值: ${maxVal.toFixed(2)} (${maxPoint?.type}), 最小值: ${minVal.toFixed(2)} (${minPoint?.type})`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
            
            // 标记点
            criticalPoints.forEach(p => {
                const xIndex = labels.indexOf(p.x.toFixed(1));
                if (xIndex >= 0) {
                    if (p.type === '极大值') {
                        extremaChart.data.datasets[1].data[xIndex] = p.y;
                    } else if (p.type === '极小值') {
                        extremaChart.data.datasets[2].data[xIndex] = p.y;
                    }
                }
            });
            
            if (minPoint) {
                const minIndex = labels.indexOf(minPoint.x.toFixed(1));
                if (minIndex >= 0) extremaChart.data.datasets[3].data[minIndex] = minVal;
            }
            
            if (maxPoint) {
                const maxIndex = labels.indexOf(maxPoint.x.toFixed(1));
                if (maxIndex >= 0) extremaChart.data.datasets[3].data[maxIndex] = maxVal;
            }
            
            extremaChart.update();
        }
        
        // 曲率图形
        let curvatureChart = null;
        
        function updateCurvatureGraph() {
            const functionType = document.getElementById('curvature-function').value;
            const x0 = parseFloat(document.getElementById('curvature-x').value);
            
            document.getElementById('curvature-x-val').textContent = x0.toFixed(1);
            
            let func, derivative, secondDerivative, funcName;
            
            switch(functionType) {
                case 'x^2':
                    func = x => x*x;
                    derivative = x => 2*x;
                    secondDerivative = x => 2;
                    funcName = 'y=x²';
                    break;
                case 'sin(x)':
                    func = x => Math.sin(x);
                    derivative = x => Math.cos(x);
                    secondDerivative = x => -Math.sin(x);
                    funcName = 'y=sin(x)';
                    break;
                case 'e^x':
                    func = x => Math.exp(x);
                    derivative = x => Math.exp(x);
                    secondDerivative = x => Math.exp(x);
                    funcName = 'y=e^x';
                    break;
                case 'ln(x)':
                    func = x => Math.log(x);
                    derivative = x => 1/x;
                    secondDerivative = x => -1/(x*x);
                    funcName = 'y=ln(x)';
                    break;
            }
            
            // 计算曲率
            const y0 = func(x0);
            const y0prime = derivative(x0);
            const y0doublePrime = secondDerivative(x0);
            const curvature = Math.abs(y0doublePrime) / Math.pow(1 + y0prime*y0prime, 1.5);
            const radius = curvature > 0.0001 ? 1/curvature : Infinity;
            
            // 生成数据
            const labels = [];
            const data = [];
            const osculatingCircle = [];
            
            const xMin = x0 - 2, xMax = x0 + 2;
            
            for (let i = 0; i <= 100; i++) {
                const x = xMin + i * (xMax - xMin) / 100;
                labels.push(x.toFixed(1));
                data.push(func(x));
                
                // 密切圆
                if (curvature > 0.0001) {
                    const centerX = x0 - y0prime * (1 + y0prime*y0prime) / y0doublePrime;
                    const centerY = y0 + (1 + y0prime*y0prime) / y0doublePrime;
                    const dx = x - centerX;
                    const circleY = centerY + Math.sqrt(radius*radius - dx*dx);
                    osculatingCircle.push(Math.abs(dx) <= radius + 0.1 ? circleY : null);
                } else {
                    osculatingCircle.push(null);
                }
            }
            
            const ctx = document.getElementById('curvature-graph').getContext('2d');
            
            if (curvatureChart) {
                curvatureChart.destroy();
            }
            
            curvatureChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: funcName,
                        data: data,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: '密切圆',
                        data: osculatingCircle,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }, {
                        label: '考察点',
                        data: Array(labels.length).fill(null),
                        backgroundColor: '#4cc9f0',
                        borderColor: '#4cc9f0',
                        borderWidth: 0,
                        pointRadius: 6,
                        pointBackgroundColor: '#4cc9f0'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'y'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `在x=${x0.toFixed(2)}处: 曲率K=${curvature.toFixed(4)}, 曲率半径R=${radius.toFixed(2)}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
            
            // 标记考察点
            const pointIndex = labels.indexOf(x0.toFixed(1));
            if (pointIndex >= 0) {
                curvatureChart.data.datasets[2].data[pointIndex] = y0;
            }
            
            curvatureChart.update();
        }
        
        // 泰勒公式图形
        let taylorChart = null;
        
        function updateTaylorGraph() {
            const functionType = document.getElementById('taylor-function').value;
            const n = parseInt(document.getElementById('taylor-n').value);
            const x0 = parseFloat(document.getElementById('taylor-x0').value);
            
            document.getElementById('taylor-n-val').textContent = n;
            document.getElementById('taylor-x0-val').textContent = x0.toFixed(1);
            
            let originalFunc, taylorFunc, funcName;
            
            switch(functionType) {
                case 'sin(x)':
                    originalFunc = x => Math.sin(x);
                    funcName = 'sin(x)';
                    taylorFunc = x => {
                        let result = Math.sin(x0);
                        for (let k = 1; k <= n; k++) {
                            let derivative;
                            if (k % 4 === 1) derivative = Math.cos(x0);
                            else if (k % 4 === 2) derivative = -Math.sin(x0);
                            else if (k % 4 === 3) derivative = -Math.cos(x0);
                            else derivative = Math.sin(x0);
                            
                            result += derivative * Math.pow(x - x0, k) / factorial(k);
                        }
                        return result;
                    };
                    break;
                case 'cos(x)':
                    originalFunc = x => Math.cos(x);
                    funcName = 'cos(x)';
                    taylorFunc = x => {
                        let result = Math.cos(x0);
                        for (let k = 1; k <= n; k++) {
                            let derivative;
                            if (k % 4 === 1) derivative = -Math.sin(x0);
                            else if (k % 4 === 2) derivative = -Math.cos(x0);
                            else if (k % 4 === 3) derivative = Math.sin(x0);
                            else derivative = Math.cos(x0);
                            
                            result += derivative * Math.pow(x - x0, k) / factorial(k);
                        }
                        return result;
                    };
                    break;
                case 'e^x':
                    originalFunc = x => Math.exp(x);
                    funcName = 'e^x';
                    taylorFunc = x => {
                        let result = Math.exp(x0);
                        for (let k = 1; k <= n; k++) {
                            result += Math.exp(x0) * Math.pow(x - x0, k) / factorial(k);
                        }
                        return result;
                    };
                    break;
                case 'ln(1+x)':
                    originalFunc = x => Math.log(1 + x);
                    funcName = 'ln(1+x)';
                    taylorFunc = x => {
                        if (x0 !== 0) return Math.log(1 + x); // 简化处理
                        let result = 0;
                        for (let k = 1; k <= n; k++) {
                            result += Math.pow(-1, k-1) * Math.pow(x, k) / k;
                        }
                        return result;
                    };
                    break;
            }
            
            // 生成数据
            const labels = [];
            const originalData = [];
            const taylorData = [];
            
            const range = 2;
            const xMin = x0 - range;
            const xMax = x0 + range;
            
            for (let i = 0; i <= 100; i++) {
                const x = xMin + i * (xMax - xMin) / 100;
                labels.push(x.toFixed(1));
                
                originalData.push(originalFunc(x));
                taylorData.push(taylorFunc(x));
            }
            
            const ctx = document.getElementById('taylor-graph').getContext('2d');
            
            if (taylorChart) {
                taylorChart.destroy();
            }
            
            taylorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `原始函数 ${funcName}`,
                        data: originalData,
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.1
                    }, {
                        label: `${n}阶泰勒多项式`,
                        data: taylorData,
                        borderColor: '#f72585',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'x'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'y'
                            }
                        }
                    },
                    plugins: {
                        subtitle: {
                            display: true,
                            text: `在x₀=${x0.toFixed(1)}处用${n}阶多项式逼近${funcName}`,
                            font: {
                                size: 14
                            },
                            padding: {
                                bottom: 10
                            }
                        }
                    }
                }
            });
        }
        
        // 辅助函数：阶乘
        function factorial(n) {
            if (n <= 1) return 1;
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }
    </script>
</body>
</html>